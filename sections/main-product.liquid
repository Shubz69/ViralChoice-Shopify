{% comment %}
  ViralChoice Main Product Section
  Premium product page with modern layout
{% endcomment %}

<div class="vc-product-page">
  <div class="vc-product-page__grid">
    {% comment %} Product Images {% endcomment %}
    <div class="vc-product-page__images">
      <div class="vc-product-page__image">
        {% if product.featured_image %}
          <img 
            src="{{ product.featured_image | image_url: width: 1200 }}"
            srcset="{{ product.featured_image | image_url: width: 600 }} 600w,
                    {{ product.featured_image | image_url: width: 900 }} 900w,
                    {{ product.featured_image | image_url: width: 1200 }} 1200w,
                    {{ product.featured_image | image_url: width: 1600 }} 1600w"
            sizes="(max-width: 768px) 100vw, (max-width: 1024px) 50vw, 800px"
            alt="{{ product.featured_image.alt | escape }}"
            id="ProductImage-{{ section.id }}"
            loading="eager"
          >
        {% else %}
          {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
        {% endif %}
      </div>
      
      {% if product.images.size > 1 %}
        <div class="vc-product-page__thumbnails">
          {% for image in product.images %}
            <div class="vc-product-page__thumbnail">
              <img 
                src="{{ image | image_url: width: 200 }}"
                alt="{{ image.alt | escape }}"
                loading="lazy"
              >
            </div>
          {% endfor %}
        </div>
      {% endif %}
    </div>
    
    {% comment %} Product Info {% endcomment %}
    <div class="vc-product-page__info">
      <h1 class="vc-product-page__title">{{ product.title }}</h1>
      
      <div class="vc-product-page__price">
        {{ product.price | money }}
        {% if product.compare_at_price > product.price %}
          <span class="vc-product-page__price-compare">{{ product.compare_at_price | money }}</span>
        {% endif %}
      </div>
      
      {% comment %} Product Form {% endcomment %}
      <product-form class="vc-product-page__form">
        {% form 'product', product, id: 'product-form', class: 'form', novalidate: 'novalidate', data-type: 'add-to-cart-form' %}
          {% if product.variants.size > 1 %}
            <div class="vc-product-page__form-group">
              <label for="product-select-{{ section.id }}" class="vc-product-page__label">
                Select Option
              </label>
              <select 
                name="id" 
                id="product-select-{{ section.id }}"
                class="vc-product-page__select"
                required
              >
                {% for variant in product.variants %}
                  <option 
                    value="{{ variant.id }}"
                    {% if variant == product.selected_or_first_available_variant %}selected="selected"{% endif %}
                    {% unless variant.available %}disabled{% endunless %}
                  >
                    {{ variant.title }} - {{ variant.price | money }}
                    {% unless variant.available %} ({{ 'products.product.sold_out' | t }}){% endunless %}
                  </option>
                {% endfor %}
              </select>
            </div>
          {% else %}
            <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
          {% endif %}
          
          <div class="vc-product-page__form-group">
            <label for="Quantity-{{ section.id }}" class="vc-product-page__label">
              {{ 'products.product.quantity' | t }}
            </label>
            <input 
              type="number" 
              id="Quantity-{{ section.id }}"
              name="quantity" 
              value="1" 
              min="1"
              class="vc-product-page__input"
            >
          </div>
          
          <button
            type="submit"
            name="add"
            class="vc-product-page__add-to-cart"
            id="product-submit-{{ section.id }}"
            {% unless product.selected_or_first_available_variant.available %}disabled{% endunless %}
          >
            {% if product.selected_or_first_available_variant.available %}
              {{ 'products.product.add_to_cart' | t }}
            {% else %}
              {{ 'products.product.sold_out' | t }}
            {% endif %}
          </button>
        {% endform %}
      </product-form>
      
      {% comment %} Trust Badges Under ATC {% endcomment %}
      {% render 'vc-trust-badges' %}
      
      {% comment %} Collapsible Sections {% endcomment %}
      {% if product.description != blank %}
        <div class="vc-product-page__collapsible">
          <button class="vc-product-page__collapsible-header">
            Product Details
          </button>
          <div class="vc-product-page__collapsible-content">
            {{ product.description }}
          </div>
        </div>
      {% endif %}
      
      <div class="vc-product-page__collapsible">
        <button class="vc-product-page__collapsible-header">
          Shipping Information
        </button>
        <div class="vc-product-page__collapsible-content">
          <p>We offer fast and secure shipping to customers worldwide. Standard shipping typically takes 5-7 business days. Express shipping options are available at checkout for faster delivery.</p>
        </div>
      </div>
      
      <div class="vc-product-page__collapsible">
        <button class="vc-product-page__collapsible-header">
          Returns & Refunds
        </button>
        <div class="vc-product-page__collapsible-content">
          <p>We offer a 30-day money-back guarantee. If you're not completely satisfied with your purchase, you can return it for a full refund. Items must be in original condition and packaging.</p>
        </div>
      </div>
    </div>
  </div>
</div>

{% comment %} Sticky Mobile Add to Cart {% endcomment %}
<div class="vc-product-page__sticky-atc">
  <div class="vc-product-page__sticky-atc-inner">
    <div class="vc-product-page__sticky-price">
      {{ product.price | money }}
    </div>
    <button 
      type="button"
      class="vc-product-page__sticky-button"
      onclick="document.getElementById('product-submit-{{ section.id }}').click()"
    >
      {{ 'products.product.add_to_cart' | t }}
    </button>
  </div>
</div>

<script>
  (function() {
    'use strict';
    
    function initProductPage() {
      const productForm = document.querySelector('#product-form');
      if (!productForm) return;
      
      // Handle form submission
      productForm.addEventListener('submit', function(e) {
        const productSelect = document.querySelector('#product-select-{{ section.id }}');
        const hiddenInput = productForm.querySelector('input[name="id"]');
        
        if (productSelect) {
          const selectedVariantId = productSelect.value;
          if (hiddenInput) {
            hiddenInput.value = selectedVariantId;
          }
        }
      });
      
      // Variant selector change handler
      const productSelect = document.querySelector('#product-select-{{ section.id }}');
      if (productSelect) {
        productSelect.addEventListener('change', function() {
          // Form will use the select value directly
        });
      }
    }
    
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initProductPage);
    } else {
      initProductPage();
    }
  })();
</script>

{% schema %}
{
  "name": "VC Main Product",
  "tag": "section",
  "class": "section",
  "settings": []
}
{% endschema %}
